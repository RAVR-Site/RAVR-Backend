# RAVR Backend

Backend-сервис на Go для проекта RAVR.

## Структура проекта

- `cmd/` — точка входа (main.go)
- `config/` — конфигурация приложения
- `internal/` — бизнес-логика, контроллеры, сервисы, репозитории, хранилища
- `docs/` — документация и Swagger
- `migrations/` — SQL-файлы миграций для базы данных
- `Dockerfile` — сборка Docker-образа
- `docker-compose.yml` — запуск зависимостей через Docker Compose
- `Makefile` — основные команды для разработки

## Быстрый старт

### Локальный запуск

```bash
make build      # Сборка бинарника
make run        # Запуск приложения
```

### Тесты и линтинг

```bash
make test       # Запуск тестов
make lint       # Проверка линтером (golangci-lint)
```

### Docker

```bash
make docker-build   # Сборка Docker-образа
make up             # Запуск через docker-compose (включая миграции)
make up-infra       # Запуск только базы данных и миграций
make down           # Остановка docker-compose
```

### Система миграций

В проекте используется golang-migrate для управления миграциями базы данных.

```bash
# Создание новой миграции (запросит имя)
make migrate-create

# Применение миграций
export DATABASE_DSN="postgres://postgres:postgres@localhost:5432/ravr-backend?sslmode=disable"
make migrate

# Откат последней миграции
make migrate-down

# Удаление всех миграций
make migrate-drop

# Сброс и повторное применение всех миграций
make migrate-reset

# Проверка текущей версии миграций
make migrate-version
```

### Очистка

```bash
make clean     # Удаление бинарника
```

## Архитектура проекта

Проект построен с использованием принципов чистой архитектуры:

- `controller/` — обработчики HTTP-запросов
- `service/` — бизнес-логика
- `repository/` — слой доступа к данным
- `database/` — управление миграциями и соединением с БД
- `storage/` — хранение и обработка файлов

## Docker-инфраструктура

Проект включает три основных контейнера:

1. **db** - PostgreSQL база данных
2. **migrator** - сервис для применения миграций
3. **app** - основной сервис приложения

Docker Compose настроен так, что приложение запускается только после успешного применения всех миграций.

## Требования

- Go 1.24+
- golangci-lint (для линтинга)
- Docker, docker-compose (для контейнеризации)
- migrate (утилита для управления миграциями)

## Переменные окружения

Создайте файл `.env` или экспортируйте переменные окружения:

- `DATABASE_DSN` - строка подключения к базе данных
- `JWT_SECRET` - секретный ключ для JWT токенов
- `PORT` - порт для запуска сервера (по умолчанию 8080)
- `RESET_MIGRATIONS` - если `true`, сбрасывает все миграции перед применением

## Документация API

Документация API доступна в формате Swagger:

- `/swagger/*` - Swagger UI (в режиме разработки)
- `docs/swagger.json` и `docs/swagger.yaml` - спецификации OpenAPI
